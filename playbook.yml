- name: Main Playbook
  hosts: localhost
  become: false

  vars:
    fedora_version: 40
    arch: x86_64

  tasks:

  # DNF PACKAGES
    - name: Install packages dnf
      become: true
      dnf5:
        state: present
        name:
          - vim-enhanced
          - flatpak
          - gcc
          - cmake
          - rustup

    # Docker tools and containers
    # Based on https://docs.docker.com/engine/install/fedora/
    # and looking at the stable repos details inside https://download.docker.com/linux/fedora/docker-ce.repo
    # to avoid installing dnf-plugins-core
    - name: Configure Docker RPM repository
      become: true
      yum_repository:
        name: docker-ce-stable
        description: Docker CE Stable - {{ arch }}
        baseurl: "https://download.docker.com/linux/fedora/{{ fedora_version }}/{{ arch }}/stable"
        gpgkey: https://download.docker.com/linux/fedora/gpg
        repo_gpgcheck: yes
        gpgcheck: yes

    - name: Install packages dnf docker
      become: true
      dnf5:
        state: present
        name:
          - docker-ce
          - docker-ce-cli
          - containerd.io
          - docker-buildx-plugin
          - docker-compose-plugin

  # FLATPAK PACKAGES
    - name: Add the flathub flatpak repository remote to the user installation
      community.general.flatpak_remote:
        name: flathub
        state: present
        flatpakrepo_url: https://dl.flathub.org/repo/flathub.flatpakrepo
        method: user

    - name: Install packages flatpak
      flatpak:
        state: present
        method: user
        name:
          - "org.telegram.desktop"

  # RUST PACKAGES
    - name: Install rustup
      become: true
      command:
        cmd: "rustup-init -y"
      args:
        creates: "{{ansible_env.HOME}}/.cargo/bin/rustc"

    - name: Install cargo
      become: true
      community.general.cargo:
        cmd: "cargo install cargo-binstall"

    - name: Binstall packages cargo
      become: true
      vars:
        items: 
          - "gitui"
          - "tlrc"
      shell:
        cmd: "cargo binstall {{ items | join(' ') }} -y --locked --continue-on-failure"